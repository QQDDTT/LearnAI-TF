# é…ç½®æ–‡ä»¶ç»“æ„è¯´æ˜æ–‡æ¡£

> **é¡¹ç›®åç§°ï¼š** LearnAI æ·±åº¦å­¦ä¹ è®­ç»ƒæ¡†æ¶
> **æ–‡æ¡£ç‰ˆæœ¬ï¼š** v2.0
> **ç”Ÿæˆæ—¥æœŸï¼š** 2025-11-03

---

## ğŸ“‹ ç›®å½•

1. [é…ç½®æ–‡ä»¶æ¦‚è¿°](#1-é…ç½®æ–‡ä»¶æ¦‚è¿°)
2. [é¡¶å±‚ç»“æ„](#2-é¡¶å±‚ç»“æ„)
3. [è¯¦ç»†é…ç½®è¯´æ˜](#3-è¯¦ç»†é…ç½®è¯´æ˜)
4. [é…ç½®éªŒè¯è§„åˆ™](#4-é…ç½®éªŒè¯è§„åˆ™)
5. [é…ç½®ç¤ºä¾‹](#5-é…ç½®ç¤ºä¾‹)
6. [æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)

---

## 1. é…ç½®æ–‡ä»¶æ¦‚è¿°

### 1.1 è®¾è®¡ç†å¿µ

LearnAI æ¡†æ¶é‡‡ç”¨**é…ç½®é©±åŠ¨**çš„è®¾è®¡ç†å¿µï¼Œæ‰€æœ‰è®­ç»ƒè¡Œä¸ºé€šè¿‡ YAML é…ç½®æ–‡ä»¶å®šä¹‰ï¼š

- âœ… **æ— éœ€ä¿®æ”¹ä»£ç **ï¼šä»…é€šè¿‡é…ç½®æ–‡ä»¶å³å¯å®Œæˆå„ç±»æ·±åº¦å­¦ä¹ ä»»åŠ¡
- âœ… **æ¨¡å—åŒ–è®¾è®¡**ï¼šé…ç½®æ–‡ä»¶çš„æ¯ä¸ªé¡¶å±‚èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªåŠŸèƒ½æ¨¡å—
- âœ… **åå°„æœºåˆ¶**ï¼šé€šè¿‡ `reflection` å­—æ®µåŠ¨æ€åŠ è½½ Python ç±»å’Œå‡½æ•°
- âœ… **çµæ´»æ‰©å±•**ï¼šæ”¯æŒè‡ªå®šä¹‰ç»„ä»¶å’Œè®­ç»ƒæµç¨‹

### 1.2 é…ç½®æ–‡ä»¶ä½ç½®

```
LearnAI/
â”œâ”€â”€ config/                    # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ config_example.yaml   # ç¤ºä¾‹é…ç½®
â”‚   â”œâ”€â”€ supervised_config.yaml    # ç›‘ç£å­¦ä¹ 
â”‚   â”œâ”€â”€ reinforcement_config.yaml # å¼ºåŒ–å­¦ä¹ 
â”‚   â””â”€â”€ self_supervised_config.yaml # è‡ªç›‘ç£å­¦ä¹ 
```

### 1.3 åŠ è½½æ–¹å¼

```python
from common.common import load_yaml

# åŠ è½½å¹¶éªŒè¯é…ç½®
config = load_yaml("config_example.yaml")

# ä»…åŠ è½½ä¸éªŒè¯
config = load_yaml("config_example.yaml", validate=False)
```

---

## 2. é¡¶å±‚ç»“æ„

é…ç½®æ–‡ä»¶åŒ…å«ä»¥ä¸‹**å¿…éœ€**çš„é¡¶å±‚æ¨¡å—ï¼š

```yaml
global:              # å…¨å±€é…ç½®ï¼ˆé¡¹ç›®åç§°ã€ç‰ˆæœ¬ã€éšæœºç§å­ç­‰ï¼‰
training_mode:       # è®­ç»ƒæ¨¡å¼ï¼ˆsupervised/reinforcement/unsupervisedç­‰ï¼‰
models:              # æ¨¡å‹å®šä¹‰
data_manager:        # æ•°æ®ç®¡ç†
optimizers:          # ä¼˜åŒ–å™¨é…ç½®
losses:              # æŸå¤±å‡½æ•°é…ç½®
training_pipeline:   # è®­ç»ƒæµç¨‹
evaluation:          # è¯„ä¼°é…ç½®ï¼ˆå¯é€‰ï¼‰
export:              # æ¨¡å‹å¯¼å‡ºé…ç½®ï¼ˆå¯é€‰ï¼‰
deployment:          # æ¨¡å‹éƒ¨ç½²é…ç½®ï¼ˆå¯é€‰ï¼‰
```

### 2.1 æ¨¡å—ä¸ä»£ç æ–‡ä»¶æ˜ å°„

| é…ç½®èŠ‚ç‚¹ | å¯¹åº”æ¨¡å—æ–‡ä»¶ | èŒè´£ |
|---------|-------------|------|
| `global` | `common/common.py` | å…¨å±€é…ç½®ç®¡ç† |
| `training_mode` | `main.py` | è®­ç»ƒæ¨¡å¼é€‰æ‹© |
| `models` | `modules/models.py` | æ¨¡å‹æ„å»º |
| `data_manager` | `modules/data_manager.py` | æ•°æ®åŠ è½½ã€é¢„å¤„ç† |
| `optimizers` | `modules/optimizers.py` | ä¼˜åŒ–å™¨ç®¡ç† |
| `losses` | `modules/losses.py` | æŸå¤±å‡½æ•°ç®¡ç† |
| `training_pipeline` | `modules/training_pipeline.py` | è®­ç»ƒå¾ªç¯æ‰§è¡Œ |
| `evaluation` | `modules/evaluation.py` | æ¨¡å‹è¯„ä¼° |
| `export` | `modules/export.py` | æ¨¡å‹å¯¼å‡º |
| `deployment` | `modules/deployment.py` | æ¨¡å‹éƒ¨ç½² |

---

## 3. è¯¦ç»†é…ç½®è¯´æ˜

### 3.1 globalï¼ˆå…¨å±€é…ç½®ï¼‰

å®šä¹‰é¡¹ç›®çš„å…¨å±€å‚æ•°å’Œå…ƒæ•°æ®ã€‚

```yaml
global:
  name: "my_project"          # é¡¹ç›®åç§°ï¼ˆå¿…éœ€ï¼‰
  version: "v1.0.0"           # é¡¹ç›®ç‰ˆæœ¬ï¼ˆå¿…éœ€ï¼‰
  seed: 42                    # éšæœºç§å­ï¼ˆå¯é€‰ï¼Œé»˜è®¤42ï¼‰
  description: "é¡¹ç›®æè¿°"      # é¡¹ç›®æè¿°ï¼ˆå¯é€‰ï¼‰
  author: "ä½œè€…å"            # ä½œè€…ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| `name` | string | âœ… | é¡¹ç›®å”¯ä¸€æ ‡è¯†ç¬¦ |
| `version` | string | âœ… | ç‰ˆæœ¬å·ï¼ˆå»ºè®®ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼‰ |
| `seed` | integer | âŒ | éšæœºç§å­ï¼Œç”¨äºç»“æœå¤ç° |
| `description` | string | âŒ | é¡¹ç›®è¯´æ˜ |
| `author` | string | âŒ | ä½œè€…ä¿¡æ¯ |

---

### 3.2 training_modeï¼ˆè®­ç»ƒæ¨¡å¼ï¼‰

æŒ‡å®šè®­ç»ƒèŒƒå¼å’Œå­ç±»å‹ã€‚

```yaml
training_mode:
  type: "supervised"          # è®­ç»ƒç±»å‹ï¼ˆå¿…éœ€ï¼‰
  subtype: null               # å­ç±»å‹ï¼ˆå¯é€‰ï¼‰
```

**æ”¯æŒçš„è®­ç»ƒç±»å‹ï¼š**

| ç±»å‹ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| `supervised` | ç›‘ç£å­¦ä¹  | å›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹ç­‰ |
| `reinforcement` | å¼ºåŒ–å­¦ä¹  | æ¸¸æˆAIã€æœºå™¨äººæ§åˆ¶ |
| `unsupervised` | æ— ç›‘ç£å­¦ä¹  | èšç±»ã€é™ç»´ |
| `self_supervised` | è‡ªç›‘ç£å­¦ä¹  | å¯¹æ¯”å­¦ä¹ ã€MAE |
| `semi_supervised` | åŠç›‘ç£å­¦ä¹  | å°‘é‡æ ‡æ³¨æ•°æ®åœºæ™¯ |
| `multi_task` | å¤šä»»åŠ¡å­¦ä¹  | åŒæ—¶è®­ç»ƒå¤šä¸ªç›¸å…³ä»»åŠ¡ |
| `custom` | è‡ªå®šä¹‰è®­ç»ƒ | ç‰¹æ®Šè®­ç»ƒéœ€æ±‚ |

---

### 3.3 modelsï¼ˆæ¨¡å‹å®šä¹‰ï¼‰

å®šä¹‰è®­ç»ƒä¸­ä½¿ç”¨çš„æ‰€æœ‰æ¨¡å‹ã€‚

#### 3.3.1 åŸºæœ¬ç»“æ„

```yaml
models:
  <model_name>:               # æ¨¡å‹å”¯ä¸€æ ‡è¯†ç¬¦
    type: "Sequential"        # æ¨¡å‹ç±»å‹
    reflection: "..."         # åå°„è·¯å¾„
    args: {}                  # æ„é€ å‚æ•°
    layers: []                # å±‚å®šä¹‰ï¼ˆå¯é€‰ï¼‰
```

#### 3.3.2 ç¤ºä¾‹ï¼šä½¿ç”¨ Keras Sequential

```yaml
models:
  classifier:
    type: "Sequential"
    reflection: "tensorflow.keras.Sequential"
    args: {}
    layers:
      - name: "dense1"
        reflection: "tensorflow.keras.layers.Dense"
        args:
          units: 128
          activation: "relu"

      - name: "dropout1"
        reflection: "tensorflow.keras.layers.Dropout"
        args:
          rate: 0.3

      - name: "output"
        reflection: "tensorflow.keras.layers.Dense"
        args:
          units: 10
          activation: "softmax"
```

#### 3.3.3 ç¤ºä¾‹ï¼šä½¿ç”¨è‡ªå®šä¹‰æ¨¡å‹

```yaml
models:
  custom_cnn:
    reflection: "modules.models:build_custom_cnn"
    args:
      input_shape: [224, 224, 3]
      num_classes: 1000
      backbone: "resnet50"
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| `type` | string | âŒ | æ¨¡å‹ç±»å‹æ ‡è¯† |
| `reflection` | string | âœ… | Python ç±»/å‡½æ•°è·¯å¾„ |
| `args` | dict | âŒ | ä¼ é€’ç»™æ„é€ å‡½æ•°çš„å‚æ•° |
| `layers` | list | âŒ | å±‚å®šä¹‰åˆ—è¡¨ï¼ˆSequential æ¨¡å‹ï¼‰ |

---

### 3.4 data_managerï¼ˆæ•°æ®ç®¡ç†ï¼‰

å®šä¹‰æ•°æ®æºã€åŠ è½½æ–¹å¼å’Œé¢„å¤„ç†æµç¨‹ã€‚

#### 3.4.1 åŸºæœ¬ç»“æ„

```yaml
data_manager:
  <source_name>:              # æ•°æ®æºåç§°
    train:                    # è®­ç»ƒé›†é…ç½®
      reflection: "..."       # åŠ è½½å‡½æ•°
      args: {}                # åŠ è½½å‚æ•°
    val:                      # éªŒè¯é›†é…ç½®
      reflection: "..."
      args: {}
    test:                     # æµ‹è¯•é›†é…ç½®
      reflection: "..."
      args: {}
```

#### 3.4.2 ç¤ºä¾‹ï¼šCSV æ•°æ®åŠ è½½

```yaml
data_manager:
  supervised_source:
    train:
      reflection: "modules.data_manager:load_csv_data"
      args:
        file_path: "data/train.csv"
        batch_size: 32
        shuffle: true

    val:
      reflection: "modules.data_manager:load_csv_data"
      args:
        file_path: "data/val.csv"
        batch_size: 32
        shuffle: false
```

#### 3.4.3 ç¤ºä¾‹ï¼šå›¾åƒæ•°æ®åŠ è½½

```yaml
data_manager:
  image_source:
    train:
      reflection: "tensorflow.keras.preprocessing.image_dataset_from_directory"
      args:
        directory: "data/train"
        image_size: [224, 224]
        batch_size: 32
        label_mode: "categorical"
```

#### 3.4.4 ç¤ºä¾‹ï¼šå¼ºåŒ–å­¦ä¹ ç¯å¢ƒ

```yaml
data_manager:
  reinforcement_source:
    type: "interactive"
    client:
      reflection: "common.utils:NetworkClient"
      args:
        host: "localhost"
        port: 8080
        protocol: "http"
```

---

### 3.5 optimizersï¼ˆä¼˜åŒ–å™¨é…ç½®ï¼‰

å®šä¹‰è®­ç»ƒä½¿ç”¨çš„ä¼˜åŒ–å™¨ã€‚

#### 3.5.1 åŸºæœ¬ç»“æ„

```yaml
optimizers:
  <optimizer_name>:           # ä¼˜åŒ–å™¨åç§°
    reflection: "..."         # ä¼˜åŒ–å™¨ç±»è·¯å¾„
    args: {}                  # ä¼˜åŒ–å™¨å‚æ•°
    lr_schedule:              # å­¦ä¹ ç‡è°ƒåº¦ï¼ˆå¯é€‰ï¼‰
      reflection: "..."
      args: {}
```

#### 3.5.2 ç¤ºä¾‹ï¼šAdam ä¼˜åŒ–å™¨

```yaml
optimizers:
  main_optimizer:
    reflection: "tensorflow.keras.optimizers.Adam"
    args:
      learning_rate: 0.001
      beta_1: 0.9
      beta_2: 0.999
      epsilon: 1.0e-7
```

#### 3.5.3 ç¤ºä¾‹ï¼šå¸¦å­¦ä¹ ç‡è°ƒåº¦

```yaml
optimizers:
  scheduled_optimizer:
    reflection: "tensorflow.keras.optimizers.SGD"
    args:
      learning_rate: 0.1
      momentum: 0.9
    lr_schedule:
      reflection: "tensorflow.keras.optimizers.schedules.ExponentialDecay"
      args:
        initial_learning_rate: 0.1
        decay_steps: 10000
        decay_rate: 0.96
```

---

### 3.6 lossesï¼ˆæŸå¤±å‡½æ•°é…ç½®ï¼‰

å®šä¹‰æŸå¤±å‡½æ•°ã€‚

#### 3.6.1 åŸºæœ¬ç»“æ„

```yaml
losses:
  <loss_name>:                # æŸå¤±å‡½æ•°åç§°
    reflection: "..."         # æŸå¤±å‡½æ•°ç±»/å‡½æ•°
    args: {}                  # æŸå¤±å‡½æ•°å‚æ•°
    weight: 1.0               # æŸå¤±æƒé‡ï¼ˆå¤šä»»åŠ¡å­¦ä¹ ï¼‰
```

#### 3.6.2 ç¤ºä¾‹ï¼šåˆ†ç±»æŸå¤±

```yaml
losses:
  classification_loss:
    reflection: "tensorflow.keras.losses.CategoricalCrossentropy"
    args:
      from_logits: false
      label_smoothing: 0.1
```

#### 3.6.3 ç¤ºä¾‹ï¼šè‡ªå®šä¹‰å¯¹æ¯”æŸå¤±

```yaml
losses:
  contrastive_loss:
    reflection: "modules.losses:ContrastiveLoss"
    args:
      temperature: 0.5
      margin: 1.0
```

#### 3.6.4 ç¤ºä¾‹ï¼šå¤šä»»åŠ¡æŸå¤±

```yaml
losses:
  task1_loss:
    reflection: "tensorflow.keras.losses.BinaryCrossentropy"
    weight: 1.0

  task2_loss:
    reflection: "tensorflow.keras.losses.MeanSquaredError"
    weight: 0.5
```

---

### 3.7 training_pipelineï¼ˆè®­ç»ƒæµç¨‹ï¼‰

å®šä¹‰è®­ç»ƒå¾ªç¯çš„æ‰§è¡Œé€»è¾‘ã€‚è¿™æ˜¯é…ç½®æ–‡ä»¶æœ€å¤æ‚çš„éƒ¨åˆ†ã€‚

#### 3.7.1 åŸºæœ¬ç»“æ„

```yaml
training_pipeline:
  <mode_name>:                # è®­ç»ƒæ¨¡å¼åç§°
    loop_config:              # å¾ªç¯é…ç½®
      type: "..."             # å¾ªç¯ç±»å‹
      parameters: {}          # å¾ªç¯å‚æ•°
      termination: {}         # ç»ˆæ­¢æ¡ä»¶
    step_sequence:            # æ­¥éª¤åºåˆ—
      - name: "..."           # æ­¥éª¤åç§°
        reflection: "..."     # æ‰§è¡Œå‡½æ•°
        args: {}              # å‚æ•°
        bridge: null          # Bridge æ§åˆ¶ï¼ˆå¯é€‰ï¼‰
```

#### 3.7.2 å¾ªç¯ç±»å‹ï¼ˆloop_config.typeï¼‰

| ç±»å‹ | å¿…éœ€å‚æ•° | è¯´æ˜ |
|------|---------|------|
| `epoch_batch` | `epochs`, `batch_size` | æ ‡å‡†ç›‘ç£å­¦ä¹ å¾ªç¯ |
| `episode_step` | `episodes`, `max_steps_per_episode` | å¼ºåŒ–å­¦ä¹ å¾ªç¯ |
| `iteration` | `max_iterations` | æ— ç›‘ç£å­¦ä¹ è¿­ä»£ |
| `custom` | æ— å›ºå®šå‚æ•° | è‡ªå®šä¹‰å¾ªç¯é€»è¾‘ |

#### 3.7.3 ç¤ºä¾‹ï¼šç›‘ç£å­¦ä¹ æµç¨‹

```yaml
training_pipeline:
  supervised:
    loop_config:
      type: "epoch_batch"
      parameters:
        epochs: 100
        batch_size: 32
      termination:
        check_type: "epoch_based"
        max_epochs: 100

    step_sequence:
      # å‰å‘ä¼ æ’­
      - name: "forward_pass"
        reflection: "common.utils:forward"
        args:
          model: "${main_model}"
          inputs: "${batch_data}"
        bridge: null

      # è®¡ç®—æŸå¤±
      - name: "compute_loss"
        reflection: "common.utils:compute_loss"
        args:
          loss_fn: "${classification_loss}"
          predictions: "${forward_pass}"
          targets: "${batch_labels}"
        bridge: null

      # åå‘ä¼ æ’­
      - name: "backward_pass"
        reflection: "common.utils:compute_gradients"
        args:
          loss: "${compute_loss}"
          model: "${main_model}"
        bridge: null

      # æ›´æ–°å‚æ•°
      - name: "apply_gradients"
        reflection: "common.utils:apply_gradients"
        args:
          optimizer: "${main_optimizer}"
          gradients: "${backward_pass}"
          model: "${main_model}"
        bridge: null
```

#### 3.7.4 Bridge æ§åˆ¶è¯­æ³•

Bridge ç”¨äºæ¡ä»¶è·³è½¬ã€å¾ªç¯æ§åˆ¶ç­‰é«˜çº§æµç¨‹ã€‚

**è¯­æ³•æ ¼å¼ï¼š**
```
@action:target?condition(params)
```

**æ”¯æŒçš„ actionï¼š**

| Action | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `@skip` | è·³è¿‡æ­¥éª¤ | `@skip:validation?${epoch}<10` |
| `@loop` | å¾ªç¯æ‰§è¡Œ | `@loop:train_step?${converged}==false(max_iter=100)` |
| `@branch` | æ¡ä»¶åˆ†æ”¯ | `@branch:step_a,step_b?${loss}<0.5` |
| `@jump` | è·³è½¬åˆ°æŒ‡å®šæ­¥éª¤ | `@jump:step_c?${accuracy}>0.95` |

**ç¤ºä¾‹ï¼š**

```yaml
step_sequence:
  # æ¯10ä¸ªepochéªŒè¯ä¸€æ¬¡
  - name: "validation"
    reflection: "modules.evaluation:validate_model"
    args:
      model: "${main_model}"
    bridge: "@skip:validation?${epoch}%10!=0"

  # å‡†ç¡®ç‡>95%æ—¶æå‰ç»ˆæ­¢
  - name: "check_early_stop"
    reflection: "common.utils:check_metric"
    args:
      metric: "${accuracy}"
    bridge: "@jump:save_model?${accuracy}>0.95"
```

---

### 3.8 evaluationï¼ˆè¯„ä¼°é…ç½®ï¼‰

å®šä¹‰æ¨¡å‹è¯„ä¼°æ–¹å¼ã€‚

```yaml
evaluation:
  <eval_name>:                # è¯„ä¼°é…ç½®åç§°
    reflection: "..."         # è¯„ä¼°å‡½æ•°
    args:
      model: "..."            # æ¨¡å‹å¼•ç”¨
      dataset: "..."          # æ•°æ®é›†å¼•ç”¨
      metrics: []             # æŒ‡æ ‡åˆ—è¡¨
```

#### ç¤ºä¾‹ï¼š

```yaml
evaluation:
  supervised_eval:
    reflection: "modules.evaluation:evaluate_supervised"
    args:
      model: "${classifier}"
      dataset: "${test_data}"
      metrics:
        - "accuracy"
        - "precision"
        - "recall"
        - "f1"
```

---

### 3.9 exportï¼ˆæ¨¡å‹å¯¼å‡ºé…ç½®ï¼‰

å®šä¹‰æ¨¡å‹å¯¼å‡ºæ ¼å¼å’Œè·¯å¾„ã€‚

```yaml
export:
  <export_name>:              # å¯¼å‡ºé…ç½®åç§°
    model: "..."              # æ¨¡å‹å¼•ç”¨
    format: "..."             # å¯¼å‡ºæ ¼å¼
    output_path: "..."        # è¾“å‡ºè·¯å¾„
    args: {}                  # é¢å¤–å‚æ•°
```

#### æ”¯æŒçš„å¯¼å‡ºæ ¼å¼ï¼š

| æ ¼å¼ | è¯´æ˜ | æ–‡ä»¶æ‰©å±•å |
|------|------|-----------|
| `savedmodel` | TensorFlow SavedModel | ç›®å½• |
| `h5` | Keras H5 æ ¼å¼ | `.h5` |
| `onnx` | ONNX æ ¼å¼ | `.onnx` |
| `tflite` | TensorFlow Lite | `.tflite` |

#### ç¤ºä¾‹ï¼š

```yaml
export:
  export_onnx:
    model: "${classifier}"
    format: "onnx"
    output_path: "outputs/onnx/model.onnx"
    args:
      opset_version: 13

  export_tflite:
    model: "${classifier}"
    format: "tflite"
    output_path: "outputs/tflite/model.tflite"
    args:
      optimizations: ["DEFAULT"]
```

---

### 3.10 deploymentï¼ˆæ¨¡å‹éƒ¨ç½²é…ç½®ï¼‰

å®šä¹‰æ¨¡å‹éƒ¨ç½²æ–¹å¼ã€‚

```yaml
deployment:
  <deploy_name>:              # éƒ¨ç½²é…ç½®åç§°
    type: "..."               # éƒ¨ç½²ç±»å‹
    model_path: "..."         # æ¨¡å‹è·¯å¾„
    host: "..."               # ä¸»æœºåœ°å€
    port: 0                   # ç«¯å£å·
    args: {}                  # é¢å¤–å‚æ•°
```

#### æ”¯æŒçš„éƒ¨ç½²ç±»å‹ï¼š

| ç±»å‹ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| `rest_api` | REST API æœåŠ¡å™¨ | Web åº”ç”¨é›†æˆ |
| `grpc` | gRPC æœåŠ¡å™¨ | é«˜æ€§èƒ½å¾®æœåŠ¡ |
| `tf_serving` | TensorFlow Serving | ç”Ÿäº§ç¯å¢ƒ |
| `docker` | Docker å®¹å™¨ | å®¹å™¨åŒ–éƒ¨ç½² |
| `custom` | è‡ªå®šä¹‰éƒ¨ç½² | ç‰¹æ®Šéœ€æ±‚ |

#### ç¤ºä¾‹ï¼š

```yaml
deployment:
  rest_api:
    type: "rest_api"
    model_path: "${export_paths.classifier}"
    host: "0.0.0.0"
    port: 9000
    endpoints:
      predict: "/api/predict"
      health: "/health"
    performance:
      batch_size: 32
      timeout: 30
      workers: 4
```

---

## 4. é…ç½®éªŒè¯è§„åˆ™

æ¡†æ¶æä¾›äº†ä¸¥æ ¼çš„é…ç½®éªŒè¯æœºåˆ¶ï¼ˆ`common/config_validator.py`ï¼‰ã€‚

### 4.1 ç»“æ„éªŒè¯

éªŒè¯é…ç½®æ–‡ä»¶æ˜¯å¦åŒ…å«æ‰€æœ‰å¿…éœ€çš„é¡¶å±‚æ¨¡å—ï¼š

```python
REQUIRED_MODULES = {
    "global",
    "training_mode",
    "models",
    "data_manager",
    "optimizers",
    "losses",
    "training_pipeline"
}
```

### 4.2 è®­ç»ƒæ¨¡å¼éªŒè¯

éªŒè¯ `training_mode.type` æ˜¯å¦ä¸ºæ”¯æŒçš„ç±»å‹ï¼š

```python
SUPPORTED_MODES = {
    "supervised",
    "reinforcement",
    "unsupervised",
    "self_supervised",
    "semi_supervised",
    "multi_task",
    "custom"
}
```

### 4.3 å¾ªç¯ç±»å‹éªŒè¯

éªŒè¯ `training_pipeline.loop_config.type` åŠå…¶å¿…éœ€å‚æ•°ï¼š

```python
LOOP_TYPE_REQUIRED_PARAMS = {
    "epoch_batch": {"epochs", "batch_size"},
    "episode_step": {"episodes", "max_steps_per_episode"},
    "iteration": {"max_iterations"},
    "custom": {}
}
```

### 4.4 Bridge è¡¨è¾¾å¼éªŒè¯

éªŒè¯ Bridge è¯­æ³•çš„åˆæ³•æ€§ï¼š

```python
# æ”¯æŒçš„ Bridge åŠ¨ä½œ
SUPPORTED_ACTIONS = {
    "SKIP", "LOOP", "BRANCH", "JUMP"
}

# æ¡ä»¶è¡¨è¾¾å¼è¿ç®—ç¬¦
COMPARISON_OPERATORS = {"==", "!=", ">", "<", ">=", "<="}
LOGICAL_OPERATORS = {"AND", "OR", "NOT"}
```

### 4.5 äº¤å‰å¼•ç”¨éªŒè¯

éªŒè¯å˜é‡å¼•ç”¨çš„æœ‰æ•ˆæ€§ï¼š

- æ¨¡å‹å¼•ç”¨ï¼ˆå¦‚ `${main_model}`ï¼‰å¿…é¡»åœ¨ `models` ä¸­å®šä¹‰
- æ­¥éª¤å¼•ç”¨ï¼ˆå¦‚ `${forward_pass}`ï¼‰å¿…é¡»åœ¨ `step_sequence` ä¸­å®šä¹‰
- ä¼˜åŒ–å™¨å¼•ç”¨å¿…é¡»åœ¨ `optimizers` ä¸­å®šä¹‰
- æŸå¤±å‡½æ•°å¼•ç”¨å¿…é¡»åœ¨ `losses` ä¸­å®šä¹‰

---

## 5. é…ç½®ç¤ºä¾‹

### 5.1 å®Œæ•´çš„ç›‘ç£å­¦ä¹ é…ç½®

```yaml
global:
  name: "image_classifier"
  version: "v1.0.0"
  seed: 42

training_mode:
  type: "supervised"

models:
  classifier:
    type: "Sequential"
    reflection: "tensorflow.keras.Sequential"
    layers:
      - name: "conv1"
        reflection: "tensorflow.keras.layers.Conv2D"
        args:
          filters: 32
          kernel_size: [3, 3]
          activation: "relu"

      - name: "pool1"
        reflection: "tensorflow.keras.layers.MaxPooling2D"
        args:
          pool_size: [2, 2]

      - name: "flatten"
        reflection: "tensorflow.keras.layers.Flatten"

      - name: "dense1"
        reflection: "tensorflow.keras.layers.Dense"
        args:
          units: 128
          activation: "relu"

      - name: "output"
        reflection: "tensorflow.keras.layers.Dense"
        args:
          units: 10
          activation: "softmax"

data_manager:
  supervised_source:
    train:
      reflection: "tensorflow.keras.preprocessing.image_dataset_from_directory"
      args:
        directory: "data/train"
        image_size: [128, 128]
        batch_size: 32
        label_mode: "categorical"

    val:
      reflection: "tensorflow.keras.preprocessing.image_dataset_from_directory"
      args:
        directory: "data/val"
        image_size: [128, 128]
        batch_size: 32
        label_mode: "categorical"

optimizers:
  main_optimizer:
    reflection: "tensorflow.keras.optimizers.Adam"
    args:
      learning_rate: 0.001

losses:
  classification_loss:
    reflection: "tensorflow.keras.losses.CategoricalCrossentropy"
    args:
      from_logits: false

training_pipeline:
  supervised:
    loop_config:
      type: "epoch_batch"
      parameters:
        epochs: 50
        batch_size: 32
      termination:
        check_type: "epoch_based"
        max_epochs: 50

    step_sequence:
      - name: "forward_pass"
        reflection: "common.utils:forward"
        args:
          model: "${classifier}"
          inputs: "${batch_data}"

      - name: "compute_loss"
        reflection: "common.utils:compute_loss"
        args:
          loss_fn: "${classification_loss}"
          predictions: "${forward_pass}"
          targets: "${batch_labels}"

      - name: "backward_pass"
        reflection: "common.utils:compute_gradients"
        args:
          loss: "${compute_loss}"
          model: "${classifier}"

      - name: "apply_gradients"
        reflection: "common.utils:apply_gradients"
        args:
          optimizer: "${main_optimizer}"
          gradients: "${backward_pass}"
          model: "${classifier}"

evaluation:
  supervised_eval:
    reflection: "modules.evaluation:evaluate_supervised"
    args:
      model: "${classifier}"
      dataset: "${val_data}"
      metrics:
        - "accuracy"
        - "precision"
        - "recall"

export:
  export_onnx:
    model: "${classifier}"
    format: "onnx"
    output_path: "outputs/onnx/classifier.onnx"

deployment:
  rest_api:
    type: "rest_api"
    model_path: "${export_paths.classifier}"
    host: "0.0.0.0"
    port: 9000
```

### 5.2 å¼ºåŒ–å­¦ä¹ é…ç½®ç¤ºä¾‹

```yaml
global:
  name: "rl_agent"
  version: "v1.0.0"
  seed: 123

training_mode:
  type: "reinforcement"

models:
  policy_network:
    reflection: "modules.models:build_policy_network"
    args:
      state_dim: 4
      action_dim: 2
      hidden_units: [64, 64]

data_manager:
  reinforcement_source:
    type: "interactive"
    client:
      reflection: "common.utils:NetworkClient"
      args:
        host: "localhost"
        port: 8080

optimizers:
  policy_optimizer:
    reflection: "tensorflow.keras.optimizers.Adam"
    args:
      learning_rate: 0.0003

losses:
  policy_loss:
    reflection: "modules.losses:PolicyGradientLoss"

training_pipeline:
  reinforcement:
    loop_config:
      type: "episode_step"
      parameters:
        episodes: 1000
        max_steps_per_episode: 500
      termination:
        check_type: "episode_based"
        max_episodes: 1000

    step_sequence:
      - name: "observe_state"
        reflection: "common.utils:observe_state"
        args:
          client: "${rl_client}"

      - name: "select_action"
        reflection: "common.utils:select_action"
        args:
          policy: "${policy_network}"
          state: "${observe_state}"

      - name: "step_environment"
        reflection: "common.utils:step_environment"
        args:
          client: "${rl_client}"
          action: "${select_action}"

      - name: "compute_reward"
        reflection: "modules.reward_functions:compute_reward"
        args:
          state: "${observe_state}"
          action: "${select_action}"
          next_state: "${step_environment.next_state}"

      - name: "update_policy"
        reflection: "common.utils:update_policy"
        args:
          optimizer: "${policy_optimizer}"
          policy: "${policy_network}"
          reward: "${compute_reward}"
```

---

## 6. æœ€ä½³å®è·µ

### 6.1 é…ç½®æ–‡ä»¶ç»„ç»‡

âœ… **æ¨èåšæ³•ï¼š**

```
config/
â”œâ”€â”€ base_config.yaml          # åŸºç¡€é…ç½®ï¼ˆå¯è¢«ç»§æ‰¿ï¼‰
â”œâ”€â”€ supervised/
â”‚   â”œâ”€â”€ image_classification.yaml
â”‚   â””â”€â”€ text_classification.yaml
â”œâ”€â”€ reinforcement/
â”‚   â”œâ”€â”€ dqn_config.yaml
â”‚   â””â”€â”€ ppo_config.yaml
â””â”€â”€ production/
    â””â”€â”€ deployment_config.yaml
```

### 6.2 å˜é‡å¼•ç”¨è§„èŒƒ

- ä½¿ç”¨ `${å˜é‡å}` å¼•ç”¨å…¶ä»–é…ç½®é¡¹
- ä½¿ç”¨ `${æ­¥éª¤å.å­—æ®µ}` å¼•ç”¨æ­¥éª¤è¾“å‡º
- ä¿æŒå¼•ç”¨é“¾ç®€æ´ï¼Œé¿å…è¿‡åº¦åµŒå¥—

### 6.3 æ¨¡å—åŒ–åŸåˆ™

- æ¯ä¸ªæ¨¡å‹å®šä¹‰ä¸ºç‹¬ç«‹çš„é…ç½®å—
- å¤ç”¨æ€§é«˜çš„ç»„ä»¶æå–ä¸ºå•ç‹¬é…ç½®
- ä½¿ç”¨ `reflection` å­—æ®µåŠ¨æ€åŠ è½½ï¼Œé¿å…ç¡¬ç¼–ç 

### 6.4 é”™è¯¯å¤„ç†

åœ¨é…ç½®éªŒè¯å¤±è´¥æ—¶ï¼ŒæŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼š

```python
from common.config_validator import validate_config_file

is_valid, errors, warnings = validate_config_file(config)

if not is_valid:
    for error in errors:
        print(f"é”™è¯¯: {error}")

for warning in warnings:
    print(f"è­¦å‘Š: {warning}")
```

### 6.5 ç‰ˆæœ¬æ§åˆ¶

- é…ç½®æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶ï¼ˆGitï¼‰
- é‡è¦å˜æ›´è®°å½•åœ¨ `global.version` å­—æ®µ
- ä½¿ç”¨åˆ†æ”¯ç®¡ç†ä¸åŒå®éªŒçš„é…ç½®

### 6.6 æ€§èƒ½ä¼˜åŒ–

- åˆç†è®¾ç½® `batch_size`ï¼Œå¹³è¡¡å†…å­˜å’Œé€Ÿåº¦
- ä½¿ç”¨å­¦ä¹ ç‡è°ƒåº¦æå‡è®­ç»ƒæ•ˆæœ
- æ ¹æ®ç¡¬ä»¶é…ç½®è°ƒæ•´ `workers` å‚æ•°

---

## 7. å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•è°ƒè¯•é…ç½®æ–‡ä»¶ï¼Ÿ

**A:** ä½¿ç”¨ `--dry-run` é€‰é¡¹éªŒè¯é…ç½®è€Œä¸å®é™…æ‰§è¡Œï¼š

```bash
python main.py config.yaml --dry-run
```

### Q2: å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰ç»„ä»¶ï¼Ÿ

**A:** åœ¨ `modules/` ç›®å½•ä¸‹åˆ›å»ºè‡ªå®šä¹‰æ¨¡å—ï¼Œç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡ `reflection` å¼•ç”¨ï¼š

```yaml
models:
  my_model:
    reflection: "modules.custom_models:MyCustomModel"
    args:
      param1: value1
```

### Q3: å¦‚ä½•æ”¯æŒå¤š GPU è®­ç»ƒï¼Ÿ

**A:** åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®åˆ†å¸ƒå¼ç­–ç•¥ï¼š

```yaml
global:
  distributed_strategy:
    type: "MirroredStrategy"
    devices: ["GPU:0", "GPU:1"]
```

### Q4: å¦‚ä½•å®ç°æ¨¡å‹çƒ­æ›´æ–°ï¼Ÿ

**A:** ä½¿ç”¨éƒ¨ç½²é…ç½®ä¸­çš„ `auto_reload` é€‰é¡¹ï¼š

```yaml
deployment:
  rest_api:
    auto_reload: true
    reload_interval: 60  # ç§’
```

---

## 8. é™„å½•

### 8.1 å®Œæ•´çš„åå°„è·¯å¾„ç¤ºä¾‹

#### TensorFlow/Keras ç»„ä»¶

```yaml
# æ¨¡å‹
tensorflow.keras.Sequential
tensorflow.keras.Model

# å±‚
tensorflow.keras.layers.Dense
tensorflow.keras.layers.Conv2D
tensorflow.keras.layers.LSTM
tensorflow.keras.layers.Dropout
tensorflow.keras.layers.BatchNormalization

# ä¼˜åŒ–å™¨
tensorflow.keras.optimizers.Adam
tensorflow.keras.optimizers.SGD
tensorflow.keras.optimizers.RMSprop

# æŸå¤±å‡½æ•°
tensorflow.keras.losses.CategoricalCrossentropy
tensorflow.keras.losses.BinaryCrossentropy
tensorflow.keras.losses.MeanSquaredError

# æŒ‡æ ‡
tensorflow.keras.metrics.Accuracy
tensorflow.keras.metrics.Precision
tensorflow.keras.metrics.Recall
```

#### è‡ªå®šä¹‰ç»„ä»¶

```yaml
# æ•°æ®ç®¡ç†
modules.data_manager:load_csv_data
modules.data_manager:DataAugmentation

# æ¨¡å‹æ„å»º
modules.models:build_sequential_model
modules.models:build_custom_cnn

# æŸå¤±å‡½æ•°
modules.losses:ContrastiveLoss
modules.losses:FocalLoss
modules.losses:MultiTaskLoss

# è®­ç»ƒæµç¨‹
modules.training_pipeline:run_supervised_training
modules.training_pipeline:execute_training_step

# è¯„ä¼°
modules.evaluation:evaluate_supervised
modules.evaluation:compute_metrics

# å·¥å…·å‡½æ•°
common.utils:forward
common.utils:compute_loss
common.utils:compute_gradients
common.utils:apply_gradients
```

### 8.2 é…ç½®æ¨¡æ¿ç”Ÿæˆå™¨

ä½¿ç”¨å†…ç½®å·¥å…·ç”Ÿæˆé…ç½®æ¨¡æ¿ï¼š

```python
from common.common import generate_config_template

# ç”Ÿæˆç›‘ç£å­¦ä¹ æ¨¡æ¿
template = generate_config_template(
    training_mode="supervised",
    output_file="my_supervised_config.yaml"
)

# ç”Ÿæˆå¼ºåŒ–å­¦ä¹ æ¨¡æ¿
template = generate_config_template(
    training_mode="reinforcement",
    output_file="my_rl_config.yaml"
)
```

### 8.3 é…ç½®å·®å¼‚æ¯”è¾ƒ

æ¯”è¾ƒä¸¤ä¸ªé…ç½®æ–‡ä»¶çš„å·®å¼‚ï¼š

```python
from common.common import compare_configs, load_yaml

config1 = load_yaml("config_v1.yaml", validate=False)
config2 = load_yaml("config_v2.yaml", validate=False)

differences = compare_configs(config1, config2)

for diff in differences:
    print(diff)
```

---

## 9. æ›´æ–°æ—¥å¿—

### v2.0 (2025-11-03)

- âœ… å®Œæ•´çš„é…ç½®æ–‡ä»¶ç»“æ„è¯´æ˜
- âœ… æ·»åŠ æ‰€æœ‰æ¨¡å—çš„è¯¦ç»†é…ç½®è¯´æ˜
- âœ… å¢åŠ é…ç½®éªŒè¯è§„åˆ™æ–‡æ¡£
- âœ… æä¾›å¤šç§åœºæ™¯çš„é…ç½®ç¤ºä¾‹
- âœ… è¡¥å……æœ€ä½³å®è·µå’Œå¸¸è§é—®é¢˜

---

## 10. å‚è€ƒèµ„æº

- **é¡¹ç›®README:** `README.md`
- **é…ç½®éªŒè¯å™¨:** `common/config_validator.py`
- **è®­ç»ƒä¸Šä¸‹æ–‡:** `common/train_context.py`
- **ç¤ºä¾‹é…ç½®:** `config/config_example.yaml`

---

**æ–‡æ¡£ç»´æŠ¤è€…:** LearnAI å¼€å‘å›¢é˜Ÿ
**æœ€åæ›´æ–°:** 2025-11-03
