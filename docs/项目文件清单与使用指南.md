# æ·±åº¦å­¦ä¹ è®­ç»ƒæ¡†æ¶ - å®Œæ•´æ–‡ä»¶æ¸…å•

## âœ… å·²ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨

### ğŸ“ æ ¸å¿ƒæ–‡ä»¶ï¼ˆ9ä¸ªï¼‰

| æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| `main.py` | âœ… | ä¸»å…¥å£ï¼Œé…ç½®é©±åŠ¨è°ƒåº¦å™¨ |
| `common/common.py` | âœ… | æ—¥å¿—ã€åå°„ã€é…ç½®åŠ è½½ |
| `common/utils.py` | âœ… | çº¯å·¥å…·å‡½æ•°ï¼ˆç²¾ç®€ç‰ˆï¼‰ |
| `modules/__init__.py` | âœ… | æ¨¡å—åŒ…åˆå§‹åŒ– |
| `modules/data_manager.py` | âœ… | æ•°æ®ç®¡ç†ï¼ˆå«å¢å¼ºï¼‰ |
| `modules/models.py` | âœ… | æ¨¡å‹æ„å»º |
| `modules/optimizers.py` | âœ… | ä¼˜åŒ–å™¨ç®¡ç† |
| `modules/losses.py` | âœ… | æŸå¤±å‡½æ•°ï¼ˆå«è‡ªå®šä¹‰ï¼‰ |
| `modules/training_pipeline.py` | âœ… | è®­ç»ƒæµç¨‹æ§åˆ¶ |
| `modules/evaluation.py` | âœ… | è¯„ä¼°é€»è¾‘ |
| `modules/reward_functions.py` | âœ… | å¼ºåŒ–å­¦ä¹ å¥–åŠ± |
| `modules/export.py` | âœ… | æ¨¡å‹å¯¼å‡º |
| `modules/deployment.py` | âœ… | æ¨¡å‹éƒ¨ç½² |
| `config/config_example.yaml` | âœ… | ç¤ºä¾‹é…ç½®æ–‡ä»¶ |

### ğŸ“„ æ–‡æ¡£æ–‡ä»¶ï¼ˆ2ä¸ªï¼‰

| æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| `é¡¹ç›®ç»“æ„è®¾è®¡æ–‡æ¡£` | âœ… | æ¶æ„è®¾è®¡è¯¦è§£ |
| `é¡¹ç›®æ–‡ä»¶æ¸…å•ä¸ä½¿ç”¨æŒ‡å—` | âœ… | æœ¬æ–‡ä»¶ |

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„

```bash
mkdir -p LearnAI/{config,common,modules,data,logs,checkpoints,outputs}
cd LearnAI
```

### 2. åˆ›å»ºæ–‡ä»¶

å°†ä»¥ä¸‹æ–‡ä»¶ä¿å­˜åˆ°å¯¹åº”ä½ç½®ï¼š

```
LearnAI/
â”œâ”€â”€ main.py
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config_example.yaml
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ __init__.py (åˆ›å»ºç©ºæ–‡ä»¶)
â”‚   â”œâ”€â”€ common.py
â”‚   â””â”€â”€ utils.py
â””â”€â”€ modules/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ data_manager.py
    â”œâ”€â”€ models.py
    â”œâ”€â”€ optimizers.py
    â”œâ”€â”€ losses.py
    â”œâ”€â”€ training_pipeline.py
    â”œâ”€â”€ evaluation.py
    â”œâ”€â”€ reward_functions.py
    â”œâ”€â”€ export.py
    â””â”€â”€ deployment.py
```

### 3. å®‰è£…ä¾èµ–

```bash
pip install tensorflow pandas numpy pyyaml colorama requests flask tf2onnx scikit-learn scipy
```

### 4. å‡†å¤‡æ•°æ®

åˆ›å»ºç¤ºä¾‹CSVæ•°æ®ï¼š

```python
# create_sample_data.py
import pandas as pd
import numpy as np

# åˆ›å»ºè®­ç»ƒæ•°æ®
X_train = np.random.randn(1000, 784)
y_train = np.random.randint(0, 10, 1000)
pd.DataFrame(np.column_stack([X_train, y_train])).to_csv('data/train.csv', index=False)

# åˆ›å»ºéªŒè¯æ•°æ®
X_val = np.random.randn(200, 784)
y_val = np.random.randint(0, 10, 200)
pd.DataFrame(np.column_stack([X_val, y_val])).to_csv('data/val.csv', index=False)

# åˆ›å»ºæµ‹è¯•æ•°æ®
X_test = np.random.randn(200, 784)
y_test = np.random.randint(0, 10, 200)
pd.DataFrame(np.column_stack([X_test, y_test])).to_csv('data/test.csv', index=False)

print("ç¤ºä¾‹æ•°æ®åˆ›å»ºå®Œæˆï¼")
```

```bash
python create_sample_data.py
```

### 5. è¿è¡Œè®­ç»ƒ

```bash
# è®¾ç½®æ—¥å¿—ç›®å½•
export LOG_HOME=./logs

# è¿è¡Œè®­ç»ƒ
python main.py config/config_example.yaml
```

## ğŸ“ é…ç½®æ–‡ä»¶ç¤ºä¾‹

### ç›‘ç£å­¦ä¹ é…ç½®ï¼ˆæœ€å°é…ç½®ï¼‰

```yaml
# config/supervised_minimal.yaml
global:
  name: "MNIST_Classifier"
  seed: 42

training_mode:
  type: "supervised"

models:
  classifier:
    type: "Sequential"
    reflection: tensorflow.keras.Sequential
    layers:
      - reflection: tensorflow.keras.layers.Dense
        args:
          units: 128
          activation: relu
          input_shape: [784]
      - reflection: tensorflow.keras.layers.Dense
        args:
          units: 10
          activation: softmax

optimizers:
  main_optimizer:
    reflection: tensorflow.keras.optimizers.Adam
    args:
      learning_rate: 0.001

losses:
  classification_loss:
    reflection: tensorflow.keras.losses.SparseCategoricalCrossentropy
    args:
      from_logits: false

data_manager:
  supervised_source:
    train:
      reflection: common.utils:build_csv_dataset
      args:
        file_path: "data/train.csv"
        batch_size: 64
        shuffle: true
    val:
      reflection: common.utils:build_csv_dataset
      args:
        file_path: "data/val.csv"
        batch_size: 64
        shuffle: false

training_pipeline:
  supervised:
    loop_type: "epoch_batch"
    parameters:
      epochs: 10

evaluation:
  supervised_eval:
    metrics: ["accuracy"]

export:
  enabled: false
```

### å¼ºåŒ–å­¦ä¹ é…ç½®ï¼ˆæœ€å°é…ç½®ï¼‰

```yaml
# config/rl_minimal.yaml
global:
  name: "RL_Agent"
  seed: 42

training_mode:
  type: "reinforcement"

models:
  actor:
    type: "Sequential"
    reflection: tensorflow.keras.Sequential
    layers:
      - reflection: tensorflow.keras.layers.Dense
        args:
          units: 64
          activation: relu
          input_shape: [4]
      - reflection: tensorflow.keras.layers.Dense
        args:
          units: 2
          activation: softmax

optimizers:
  actor_opt:
    reflection: tensorflow.keras.optimizers.Adam
    args:
      learning_rate: 0.001

data_manager:
  rl_source:
    client:
      reflection: common.utils:NetworkClient
      args:
        host: "localhost"
        port: 8080
        timeout: 30
        endpoints:
          reset: "/reset"
          step: "/step"

training_pipeline:
  reinforcement:
    loop_type: "episode_step"
    parameters:
      episodes: 100
      steps_per_episode: 200

export:
  enabled: false
```

## ğŸ§ª æµ‹è¯•æ¸…å•

### åŸºç¡€æµ‹è¯•

- [ ] 1. é…ç½®æ–‡ä»¶åŠ è½½æµ‹è¯•
```bash
python -c "from common.common import load_yaml; print(load_yaml('config_example.yaml'))"
```

- [ ] 2. æ—¥å¿—ç³»ç»Ÿæµ‹è¯•
```bash
python -c "from common.common import LoggerManager; logger = LoggerManager.get_logger(__file__); logger.info('æµ‹è¯•æ—¥å¿—')"
```

- [ ] 3. åå°„è°ƒç”¨æµ‹è¯•
```bash
python -c "from common.common import call_target; print(call_target('tensorflow.keras.layers:Dense', {'units': 10}))"
```

- [ ] 4. æ•°æ®åŠ è½½æµ‹è¯•
```bash
python -c "from common.utils import build_csv_dataset; ds = build_csv_dataset('data/train.csv', 32); print(ds)"
```

### æ¨¡å—æµ‹è¯•

- [ ] 5. æ¨¡å‹æ„å»ºæµ‹è¯•
```python
from modules import models
config = {
    "test_model": {
        "type": "Sequential",
        "reflection": "tensorflow.keras.Sequential",
        "layers": [
            {"reflection": "tensorflow.keras.layers.Dense", "args": {"units": 10, "input_shape": [5]}}
        ]
    }
}
model_dict = models.build_all_models(config)
print(model_dict)
```

- [ ] 6. ä¼˜åŒ–å™¨æ„å»ºæµ‹è¯•
```python
from modules import optimizers
config = {
    "test_opt": {
        "reflection": "tensorflow.keras.optimizers.Adam",
        "args": {"learning_rate": 0.001}
    }
}
opt_dict = optimizers.build_all_optimizers(config)
print(opt_dict)
```

- [ ] 7. æŸå¤±å‡½æ•°æµ‹è¯•
```python
from modules import losses
config = {
    "test_loss": {
        "reflection": "tensorflow.keras.losses.MeanSquaredError",
        "args": {}
    }
}
loss_dict = losses.build_all_losses(config)
print(loss_dict)
```

### å®Œæ•´æµç¨‹æµ‹è¯•

- [ ] 8. ç«¯åˆ°ç«¯è®­ç»ƒæµ‹è¯•ï¼ˆç›‘ç£å­¦ä¹ ï¼‰
```bash
python main.py config/supervised_minimal.yaml
```

- [ ] 9. æ—¥å¿—è¾“å‡ºæ£€æŸ¥
```bash
cat logs/LearnAI_Framework_*.log
```

- [ ] 10. æ¨¡å‹å¯¼å‡ºæµ‹è¯•
```python
# ä¿®æ”¹é…ç½®æ–‡ä»¶ export.enabled: true
python main.py config/supervised_minimal.yaml
ls -la outputs/
```

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—

åœ¨ `common/common.py` ä¸­ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼š
```python
logger.setLevel(logging.DEBUG)  # æ”¹ä¸º DEBUG
```

### 2. æ‰“å°stepæ‰§è¡Œç»“æœ

åœ¨ `modules/training_pipeline.py` çš„ `execute_step_sequence()` ä¸­æ·»åŠ ï¼š
```python
logger.debug(f"æ­¥éª¤ {step_name} ç»“æœ: {result}")
```

### 3. æ£€æŸ¥å‚æ•°è§£æ

åœ¨ `resolve_arguments()` ä¸­æ·»åŠ ï¼š
```python
logger.debug(f"åŸå§‹å‚æ•°: {args}")
logger.debug(f"è§£æåå‚æ•°: {resolved}")
```

### 4. ç›‘æ§è®­ç»ƒè¿‡ç¨‹

```python
# åœ¨è®­ç»ƒå¾ªç¯ä¸­æ·»åŠ 
import time
start_time = time.time()
# ... è®­ç»ƒä»£ç  ...
elapsed = time.time() - start_time
logger.info(f"è®­ç»ƒè€—æ—¶: {elapsed:.2f}ç§’")
```

## ğŸ“Š æ€§èƒ½åŸºå‡†

åœ¨æ ‡å‡†ç¡¬ä»¶ä¸Šçš„é¢„æœŸæ€§èƒ½ï¼š

| ä»»åŠ¡ | æ•°æ®é‡ | è®­ç»ƒæ—¶é—´ | è¯´æ˜ |
|------|--------|---------|------|
| MNISTåˆ†ç±» | 60K | ~5åˆ†é’Ÿ | 10 epochs, batch=64 |
| å¼ºåŒ–å­¦ä¹  | 1000 episodes | ~30åˆ†é’Ÿ | å–å†³äºç¯å¢ƒé€Ÿåº¦ |
| è‡ªç›‘ç£å­¦ä¹  | 50K | ~20åˆ†é’Ÿ | å¯¹æ¯”å­¦ä¹ ï¼Œbatch=64 |

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: æ‰¾ä¸åˆ°æ¨¡å—
```
ModuleNotFoundError: No module named 'common'
```
**è§£å†³**ï¼šç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼Œæˆ–æ·»åŠ åˆ°PYTHONPATH
```bash
export PYTHONPATH=$PYTHONPATH:$(pwd)
```

### é—®é¢˜2: é…ç½®æ–‡ä»¶è·¯å¾„é”™è¯¯
```
FileNotFoundError: config/config_example.yaml
```
**è§£å†³**ï¼šä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–ç¡®è®¤å½“å‰ç›®å½•
```bash
python main.py $(pwd)/config/config_example.yaml
```

### é—®é¢˜3: TensorFlowç‰ˆæœ¬ä¸å…¼å®¹
```
AttributeError: module 'tensorflow' has no attribute 'xxx'
```
**è§£å†³**ï¼šæ£€æŸ¥TensorFlowç‰ˆæœ¬
```bash
pip install tensorflow==2.13.0
```

### é—®é¢˜4: å†…å­˜ä¸è¶³
```
ResourceExhaustedError: OOM when allocating tensor
```
**è§£å†³**ï¼šå‡å°batch_sizeæˆ–å¯ç”¨æ··åˆç²¾åº¦è®­ç»ƒ

## ğŸ“š è¿›é˜¶åŠŸèƒ½

### 1. æ·»åŠ TensorBoardæ”¯æŒ

åœ¨ `modules/training_pipeline.py` ä¸­æ·»åŠ ï¼š
```python
import tensorflow as tf

# åˆ›å»ºTensorBoard writer
writer = tf.summary.create_file_writer('logs/tensorboard')

# åœ¨è®­ç»ƒå¾ªç¯ä¸­è®°å½•
with writer.as_default():
    tf.summary.scalar('loss', loss, step=epoch)
```

### 2. æ·»åŠ æ—©åœï¼ˆEarly Stoppingï¼‰

```python
best_val_loss = float('inf')
patience_counter = 0
patience = 10

for epoch in range(epochs):
    # ... è®­ç»ƒ ...
    val_loss = evaluate()

    if val_loss < best_val_loss:
        best_val_loss = val_loss
        patience_counter = 0
        save_model()
    else:
        patience_counter += 1

    if patience_counter >= patience:
        logger.info("æ—©åœè§¦å‘")
        break
```

### 3. æ·»åŠ å­¦ä¹ ç‡è°ƒåº¦

åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼š
```yaml
optimizers:
  main_optimizer:
    reflection: tensorflow.keras.optimizers.Adam
    args:
      learning_rate:
        reflection: tensorflow.keras.optimizers.schedules.ExponentialDecay
        args:
          initial_learning_rate: 0.001
          decay_steps: 1000
          decay_rate: 0.96
```

## âœ… é¡¹ç›®å®Œæˆæ£€æŸ¥æ¸…å•

- [x] æ‰€æœ‰æ ¸å¿ƒæ¨¡å—æ–‡ä»¶å·²ç”Ÿæˆ
- [x] é…ç½®æ–‡ä»¶æ¨¡æ¿å·²åˆ›å»º
- [x] æ–‡æ¡£å·²å®Œå–„
- [x] æ¶æ„è®¾è®¡ç¬¦åˆè¦æ±‚
- [x] æ¨¡å—èŒè´£æ¸…æ™°
- [x] æ²¡æœ‰"èŠ‚å¤–ç”Ÿæ"
- [x] é…ç½®é©±åŠ¨è®¾è®¡å®ç°
- [x] æ”¯æŒå¤šç§è®­ç»ƒæ¨¡å¼

## ğŸ‰ æ­å–œï¼

ä½ çš„æ·±åº¦å­¦ä¹ è®­ç»ƒæ¡†æ¶å·²ç»å®Œæˆï¼ç°åœ¨å¯ä»¥ï¼š

1. æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´é…ç½®æ–‡ä»¶
2. æ·»åŠ è‡ªå®šä¹‰çš„æ¨¡å‹ã€æŸå¤±å‡½æ•°ã€æ•°æ®æº
3. æ‰©å±•æ–°çš„è®­ç»ƒæ¨¡å¼
4. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸš€
