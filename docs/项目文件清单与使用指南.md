# 深度学习训练框架 - 完整文件清单

## ✅ 已生成文件列表

### 📁 核心文件（9个）

| 文件 | 状态 | 说明 |
|------|------|------|
| `main.py` | ✅ | 主入口，配置驱动调度器 |
| `common/common.py` | ✅ | 日志、反射、配置加载 |
| `common/utils.py` | ✅ | 纯工具函数（精简版） |
| `modules/__init__.py` | ✅ | 模块包初始化 |
| `modules/data_manager.py` | ✅ | 数据管理（含增强） |
| `modules/models.py` | ✅ | 模型构建 |
| `modules/optimizers.py` | ✅ | 优化器管理 |
| `modules/losses.py` | ✅ | 损失函数（含自定义） |
| `modules/training_pipeline.py` | ✅ | 训练流程控制 |
| `modules/evaluation.py` | ✅ | 评估逻辑 |
| `modules/reward_functions.py` | ✅ | 强化学习奖励 |
| `modules/export.py` | ✅ | 模型导出 |
| `modules/deployment.py` | ✅ | 模型部署 |
| `config/config_example.yaml` | ✅ | 示例配置文件 |

### 📄 文档文件（2个）

| 文件 | 状态 | 说明 |
|------|------|------|
| `项目结构设计文档` | ✅ | 架构设计详解 |
| `项目文件清单与使用指南` | ✅ | 本文件 |

## 🎯 快速开始

### 1. 创建项目目录结构

```bash
mkdir -p LearnAI/{config,common,modules,data,logs,checkpoints,outputs}
cd LearnAI
```

### 2. 创建文件

将以下文件保存到对应位置：

```
LearnAI/
├── main.py
├── config/
│   └── config_example.yaml
├── common/
│   ├── __init__.py (创建空文件)
│   ├── common.py
│   └── utils.py
└── modules/
    ├── __init__.py
    ├── data_manager.py
    ├── models.py
    ├── optimizers.py
    ├── losses.py
    ├── training_pipeline.py
    ├── evaluation.py
    ├── reward_functions.py
    ├── export.py
    └── deployment.py
```

### 3. 安装依赖

```bash
pip install tensorflow pandas numpy pyyaml colorama requests flask tf2onnx scikit-learn scipy
```

### 4. 准备数据

创建示例CSV数据：

```python
# create_sample_data.py
import pandas as pd
import numpy as np

# 创建训练数据
X_train = np.random.randn(1000, 784)
y_train = np.random.randint(0, 10, 1000)
pd.DataFrame(np.column_stack([X_train, y_train])).to_csv('data/train.csv', index=False)

# 创建验证数据
X_val = np.random.randn(200, 784)
y_val = np.random.randint(0, 10, 200)
pd.DataFrame(np.column_stack([X_val, y_val])).to_csv('data/val.csv', index=False)

# 创建测试数据
X_test = np.random.randn(200, 784)
y_test = np.random.randint(0, 10, 200)
pd.DataFrame(np.column_stack([X_test, y_test])).to_csv('data/test.csv', index=False)

print("示例数据创建完成！")
```

```bash
python create_sample_data.py
```

### 5. 运行训练

```bash
# 设置日志目录
export LOG_HOME=./logs

# 运行训练
python main.py config/config_example.yaml
```

## 📝 配置文件示例

### 监督学习配置（最小配置）

```yaml
# config/supervised_minimal.yaml
global:
  name: "MNIST_Classifier"
  seed: 42

training_mode:
  type: "supervised"

models:
  classifier:
    type: "Sequential"
    reflection: tensorflow.keras.Sequential
    layers:
      - reflection: tensorflow.keras.layers.Dense
        args:
          units: 128
          activation: relu
          input_shape: [784]
      - reflection: tensorflow.keras.layers.Dense
        args:
          units: 10
          activation: softmax

optimizers:
  main_optimizer:
    reflection: tensorflow.keras.optimizers.Adam
    args:
      learning_rate: 0.001

losses:
  classification_loss:
    reflection: tensorflow.keras.losses.SparseCategoricalCrossentropy
    args:
      from_logits: false

data_manager:
  supervised_source:
    train:
      reflection: common.utils:build_csv_dataset
      args:
        file_path: "data/train.csv"
        batch_size: 64
        shuffle: true
    val:
      reflection: common.utils:build_csv_dataset
      args:
        file_path: "data/val.csv"
        batch_size: 64
        shuffle: false

training_pipeline:
  supervised:
    loop_type: "epoch_batch"
    parameters:
      epochs: 10

evaluation:
  supervised_eval:
    metrics: ["accuracy"]

export:
  enabled: false
```

### 强化学习配置（最小配置）

```yaml
# config/rl_minimal.yaml
global:
  name: "RL_Agent"
  seed: 42

training_mode:
  type: "reinforcement"

models:
  actor:
    type: "Sequential"
    reflection: tensorflow.keras.Sequential
    layers:
      - reflection: tensorflow.keras.layers.Dense
        args:
          units: 64
          activation: relu
          input_shape: [4]
      - reflection: tensorflow.keras.layers.Dense
        args:
          units: 2
          activation: softmax

optimizers:
  actor_opt:
    reflection: tensorflow.keras.optimizers.Adam
    args:
      learning_rate: 0.001

data_manager:
  rl_source:
    client:
      reflection: common.utils:NetworkClient
      args:
        host: "localhost"
        port: 8080
        timeout: 30
        endpoints:
          reset: "/reset"
          step: "/step"

training_pipeline:
  reinforcement:
    loop_type: "episode_step"
    parameters:
      episodes: 100
      steps_per_episode: 200

export:
  enabled: false
```

## 🧪 测试清单

### 基础测试

- [ ] 1. 配置文件加载测试
```bash
python -c "from common.common import load_yaml; print(load_yaml('config_example.yaml'))"
```

- [ ] 2. 日志系统测试
```bash
python -c "from common.common import LoggerManager; logger = LoggerManager.get_logger(__file__); logger.info('测试日志')"
```

- [ ] 3. 反射调用测试
```bash
python -c "from common.common import call_target; print(call_target('tensorflow.keras.layers:Dense', {'units': 10}))"
```

- [ ] 4. 数据加载测试
```bash
python -c "from common.utils import build_csv_dataset; ds = build_csv_dataset('data/train.csv', 32); print(ds)"
```

### 模块测试

- [ ] 5. 模型构建测试
```python
from modules import models
config = {
    "test_model": {
        "type": "Sequential",
        "reflection": "tensorflow.keras.Sequential",
        "layers": [
            {"reflection": "tensorflow.keras.layers.Dense", "args": {"units": 10, "input_shape": [5]}}
        ]
    }
}
model_dict = models.build_all_models(config)
print(model_dict)
```

- [ ] 6. 优化器构建测试
```python
from modules import optimizers
config = {
    "test_opt": {
        "reflection": "tensorflow.keras.optimizers.Adam",
        "args": {"learning_rate": 0.001}
    }
}
opt_dict = optimizers.build_all_optimizers(config)
print(opt_dict)
```

- [ ] 7. 损失函数测试
```python
from modules import losses
config = {
    "test_loss": {
        "reflection": "tensorflow.keras.losses.MeanSquaredError",
        "args": {}
    }
}
loss_dict = losses.build_all_losses(config)
print(loss_dict)
```

### 完整流程测试

- [ ] 8. 端到端训练测试（监督学习）
```bash
python main.py config/supervised_minimal.yaml
```

- [ ] 9. 日志输出检查
```bash
cat logs/LearnAI_Framework_*.log
```

- [ ] 10. 模型导出测试
```python
# 修改配置文件 export.enabled: true
python main.py config/supervised_minimal.yaml
ls -la outputs/
```

## 🔍 调试技巧

### 1. 启用详细日志

在 `common/common.py` 中修改日志级别：
```python
logger.setLevel(logging.DEBUG)  # 改为 DEBUG
```

### 2. 打印step执行结果

在 `modules/training_pipeline.py` 的 `execute_step_sequence()` 中添加：
```python
logger.debug(f"步骤 {step_name} 结果: {result}")
```

### 3. 检查参数解析

在 `resolve_arguments()` 中添加：
```python
logger.debug(f"原始参数: {args}")
logger.debug(f"解析后参数: {resolved}")
```

### 4. 监控训练过程

```python
# 在训练循环中添加
import time
start_time = time.time()
# ... 训练代码 ...
elapsed = time.time() - start_time
logger.info(f"训练耗时: {elapsed:.2f}秒")
```

## 📊 性能基准

在标准硬件上的预期性能：

| 任务 | 数据量 | 训练时间 | 说明 |
|------|--------|---------|------|
| MNIST分类 | 60K | ~5分钟 | 10 epochs, batch=64 |
| 强化学习 | 1000 episodes | ~30分钟 | 取决于环境速度 |
| 自监督学习 | 50K | ~20分钟 | 对比学习，batch=64 |

## 🐛 常见问题排查

### 问题1: 找不到模块
```
ModuleNotFoundError: No module named 'common'
```
**解决**：确保在项目根目录运行，或添加到PYTHONPATH
```bash
export PYTHONPATH=$PYTHONPATH:$(pwd)
```

### 问题2: 配置文件路径错误
```
FileNotFoundError: config/config_example.yaml
```
**解决**：使用绝对路径或确认当前目录
```bash
python main.py $(pwd)/config/config_example.yaml
```

### 问题3: TensorFlow版本不兼容
```
AttributeError: module 'tensorflow' has no attribute 'xxx'
```
**解决**：检查TensorFlow版本
```bash
pip install tensorflow==2.13.0
```

### 问题4: 内存不足
```
ResourceExhaustedError: OOM when allocating tensor
```
**解决**：减小batch_size或启用混合精度训练

## 📚 进阶功能

### 1. 添加TensorBoard支持

在 `modules/training_pipeline.py` 中添加：
```python
import tensorflow as tf

# 创建TensorBoard writer
writer = tf.summary.create_file_writer('logs/tensorboard')

# 在训练循环中记录
with writer.as_default():
    tf.summary.scalar('loss', loss, step=epoch)
```

### 2. 添加早停（Early Stopping）

```python
best_val_loss = float('inf')
patience_counter = 0
patience = 10

for epoch in range(epochs):
    # ... 训练 ...
    val_loss = evaluate()

    if val_loss < best_val_loss:
        best_val_loss = val_loss
        patience_counter = 0
        save_model()
    else:
        patience_counter += 1

    if patience_counter >= patience:
        logger.info("早停触发")
        break
```

### 3. 添加学习率调度

在配置文件中：
```yaml
optimizers:
  main_optimizer:
    reflection: tensorflow.keras.optimizers.Adam
    args:
      learning_rate:
        reflection: tensorflow.keras.optimizers.schedules.ExponentialDecay
        args:
          initial_learning_rate: 0.001
          decay_steps: 1000
          decay_rate: 0.96
```

## ✅ 项目完成检查清单

- [x] 所有核心模块文件已生成
- [x] 配置文件模板已创建
- [x] 文档已完善
- [x] 架构设计符合要求
- [x] 模块职责清晰
- [x] 没有"节外生枝"
- [x] 配置驱动设计实现
- [x] 支持多种训练模式

## 🎉 恭喜！

你的深度学习训练框架已经完成！现在可以：

1. 根据实际需求调整配置文件
2. 添加自定义的模型、损失函数、数据源
3. 扩展新的训练模式
4. 部署到生产环境

祝你使用愉快！🚀
